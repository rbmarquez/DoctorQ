.PHONY: install dev prod start lint test fix clean check-db help

# =============================================
# DoctorQ Service AI - Makefile
# =============================================

# UV path (add to PATH if installed in ~/.local/bin)
UV := $(shell which uv 2>/dev/null || echo ~/.local/bin/uv)

help:
	@echo "DoctorQ Service AI - Comandos disponÃ­veis:"
	@echo ""
	@echo "  make install     - Instalar dependÃªncias"
	@echo "  make sync        - Instalar com dependÃªncias de dev"
	@echo "  make dev         - Executar servidor de desenvolvimento (porta 8081)"
	@echo "  make prod        - Executar servidor de produÃ§Ã£o"
	@echo "  make lint        - Executar linting"
	@echo "  make fix         - Corrigir problemas de formataÃ§Ã£o"
	@echo "  make test        - Executar testes"
	@echo "  make clean       - Limpar arquivos temporÃ¡rios"
	@echo ""

install:
	@echo "ğŸ“¦ Instalando dependÃªncias..."
	$(UV) sync

sync:
	@echo "ğŸ“¦ Instalando dependÃªncias (com dev extras)..."
	$(UV) sync --all-extras

dev:
	@echo "ğŸš€ Iniciando servidor de desenvolvimento (porta 8081)..."
	$(UV) run uvicorn src.main:app --host 0.0.0.0 --port 8081 --reload

prod:
	@echo "ğŸš€ Iniciando servidor de produÃ§Ã£o..."
	$(UV) run gunicorn src.main:app -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8081 --workers 4 --log-level info

start:
	@echo "ğŸš€ Iniciando servidor..."
	$(UV) run uvicorn src.main:app --reload

lint:
	@echo "ğŸ” Executando linting..."
	$(UV) run ruff check src/
	$(UV) run pylint src/

test:
	@echo "ğŸ§ª Executando testes..."
	$(UV) run pytest

fix:
	@echo "ğŸ”§ Corrigindo problemas de formataÃ§Ã£o..."
	$(UV) run ruff check src/ --fix
	$(UV) run isort src/
	$(UV) run black src/

clean:
	@echo "ğŸ§¹ Limpando arquivos temporÃ¡rios..."
	find . -type d -name "__pycache__" -exec rm -rf {} +
	find . -type f -name "*.pyc" -delete
	find . -type d -name ".pytest_cache" -exec rm -rf {} +
	rm -rf .venv uv.lock
