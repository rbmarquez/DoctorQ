# Configuração Cron para Backups Automáticos - DoctorQ
# UC125 - Backup e Restauração (Disaster Recovery)
#
# Instalação:
#   sudo cp scripts/backup_cron.conf /etc/cron.d/doctorq-backup
#   sudo chmod 644 /etc/cron.d/doctorq-backup
#   sudo systemctl restart cron
#
# Verificar logs:
#   tail -f /var/log/syslog | grep backup
#   tail -f /var/backups/doctorq/database/backup_*.log

# Variáveis de ambiente
SHELL=/bin/bash
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=devops@doctorq.app

# Configurações do PostgreSQL
PGHOST=10.11.2.81
PGPORT=5432
PGUSER=postgres
PGPASSWORD=postgres
PGDATABASE=doctorq

# Configurações do Backup
BACKUP_DIR=/var/backups/doctorq/database
S3_BUCKET=doctorq-backups
WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL

# ========== Agendamentos ==========

# Backup FULL (Completo)
# Todos os dias às 02:00 (horário de baixo tráfego)
0 2 * * * root /mnt/repositorios/DoctorQ/doctorq-api/scripts/backup_database.sh full

# Backup INCREMENTAL (Somente mudanças)
# A cada 6 horas (06:00, 12:00, 18:00, 00:00)
# 0 */6 * * * root /mnt/repositorios/DoctorQ/doctorq-api/scripts/backup_database.sh incremental

# Backup SEMANAL (Full com retenção de 1 ano)
# Todos os domingos às 03:00
0 3 * * 0 root /mnt/repositorios/DoctorQ/doctorq-api/scripts/backup_database.sh full && \
    cp /var/backups/doctorq/database/doctorq_full_*.sql.gz /var/backups/doctorq/database/weekly/

# Limpeza de backups antigos
# Todos os dias às 04:00
# 0 4 * * * root find /var/backups/doctorq/database -name "doctorq_daily_*.sql.gz" -mtime +30 -delete

# ========== Backup de Arquivos (MinIO/S3) ==========

# Backup de arquivos de upload (fotos, documentos, etc)
# Todos os dias às 03:00
# 0 3 * * * root /mnt/repositorios/DoctorQ/doctorq-api/scripts/backup_files.sh

# ========== Monitoramento ==========

# Verificar integridade dos backups
# Todos os dias às 05:00
# 0 5 * * * root /mnt/repositorios/DoctorQ/doctorq-api/scripts/verify_backups.sh

# Enviar relatório de backups
# Toda segunda-feira às 09:00
# 0 9 * * 1 root /mnt/repositorios/DoctorQ/doctorq-api/scripts/backup_report.sh
